
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running on EC2</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.1.0/simplex/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.0.RC1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="None" href="index.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Installation" href="install_local.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/thunder_logo.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.5.0.RC1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="tutorials.html">Tutorials</a></li>
                <li><a href="api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Thunder</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_local.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Running on EC2</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="style_guide.html">Style guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">F.A.Q.</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/freeman-lab/thunder/releases">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/basic_usage.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/thunder_context.html">Thunder context</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/input_formats.html">Input formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/images.html">Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/series.html">Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/multi_index.html">Multi-indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/clustering.html">Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/factorization.html">Factorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/regression.html">Regression</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://gitter.im/thunder-project/thunder">Gitter chatroom</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/?hl=en#!forum/thunder-user">Mailing list</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/freeman-lab/thunder">Github repo</a></li>
<li class="toctree-l1"><a class="reference external" href="http://thefreemanlab.com/thunder/">Project page</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Running on EC2</a><ul>
<li><a class="reference internal" href="#setting-up-an-amazon-account">Setting up an Amazon account</a></li>
<li><a class="reference internal" href="#create-your-key-pair">Create your key pair</a></li>
<li><a class="reference internal" href="#launch-a-cluster">Launch a cluster</a></li>
<li><a class="reference internal" href="#login-and-start">Login and start</a></li>
<li><a class="reference internal" href="#use-the-ipython-notebook">Use the iPython notebook</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="running-on-ec2">
<span id="install-ec2-ref"></span><h1>Running on EC2<a class="headerlink" href="#running-on-ec2" title="Permalink to this headline">¶</a></h1>
<p>Running Spark and Thunder on Amazon&#8217;s EC2 is an easy way to quickly leverage the computational power of a large cluster. The following instructions assume you&#8217;ve already installed Thunder as described in <a class="reference internal" href="install_local.html#install-local-ref"><em>Installation</em></a>.</p>
<div class="section" id="setting-up-an-amazon-account">
<h2>Setting up an Amazon account<a class="headerlink" href="#setting-up-an-amazon-account" title="Permalink to this headline">¶</a></h2>
<p>(You might be able to skip this step if you are already using EC2.) Go to <a class="reference external" href="http://aws.amazon.com/">AWS</a> to sign up for an account. Once you have created an account, go to <a class="reference external" href="https://console.aws.amazon.com/iam/#users">Identity and Access Management</a>, select &#8220;Users&#8221; on the left, and click &#8220;Create new users&#8221; at the top. Follow the instructions to create a user for yourself. After you create a user, a window will pop up letting you &#8220;Show User Security Credentials&#8221;. Click this to see your access key ID and secret access key (long strings of characters/numbers). Write these down, or click download to save them to a file, and close the window. While you have these handy, add the following two lines to your <tt class="docutils literal"><span class="pre">bash_profile</span></tt>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;your-access-key-id&gt;
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;your-secret-access-key&gt;
</pre></div>
</div>
<p>Open a new terminal window so these changes take effect. Back on the AWS site, click the checkbox next to your user name. In the window that appears at the bottom of the page, select &#8220;Permissions &gt; Attach user policy&#8221;, select Administrator Access policy, and click Apply Policy. If you opened a brand new account it may take a couple hours for Amazon to verify it, so wait before proceeding.</p>
</div>
<div class="section" id="create-your-key-pair">
<h2>Create your key pair<a class="headerlink" href="#create-your-key-pair" title="Permalink to this headline">¶</a></h2>
<p>Go to the <a class="reference external" href="https://console.aws.amazon.com/ec2/#KeyPairs:">Key Pair section on the EC2 console</a>. Click on the region name in the upper right (it will probably say Oregon) and select US East (N Virginia). Then click Create Key Pair at the top. Give it any name you want; we&#8217;ll assume it&#8217;s <tt class="docutils literal"><span class="pre">mykey</span></tt>. You&#8217;ll download a file called <tt class="docutils literal"><span class="pre">mykey.pem</span></tt>; we&#8217;ll assume you put it in your home folder. Set the correct permissions on this file by typing</p>
<div class="highlight-bash"><div class="highlight"><pre>chmod 600 ~/mykey.pem
</pre></div>
</div>
</div>
<div class="section" id="launch-a-cluster">
<h2>Launch a cluster<a class="headerlink" href="#launch-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>Type the following command into the terminal</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem -s &lt;number-of-nodes&gt; launch &lt;cluster-name&gt;
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">mykey</span></tt> is the key-pair that we just created, <tt class="docutils literal"><span class="pre">&lt;number-of-nodes&gt;</span></tt> is the number of nodes in your cluster (try 2 just for testing), and <tt class="docutils literal"><span class="pre">&lt;cluster-name&gt;</span></tt> is just an identifier and can be anything. This command will take a few minutes. You should see lots of activity in the terminal. If the cluster doesn&#8217;t start, which sometimes happens because the instances are slow to boot up (it will repeatedly report the error: <tt class="docutils literal"><span class="pre">ssh:</span> <span class="pre">connect</span> <span class="pre">to</span> <span class="pre">host...</span> <span class="pre">Connection</span> <span class="pre">refused</span></tt>), wait for it to end then resume:</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem launch &lt;cluster-name&gt; --resume
</pre></div>
</div>
<p>After it finishes you should see the message <tt class="docutils literal"><span class="pre">Cluster</span> <span class="pre">successfully</span> <span class="pre">launched!</span></tt> followed by a link to a URL. Go to this URL to see the Spark Web UI for your new cluster.</p>
</div>
<div class="section" id="login-and-start">
<h2>Login and start<a class="headerlink" href="#login-and-start" title="Permalink to this headline">¶</a></h2>
<p>To login just type</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem login &lt;cluster-name&gt;
</pre></div>
</div>
<p>Once logged in, start the Spark shell in iPython:</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder
</pre></div>
</div>
<p>Remember to <tt class="docutils literal"><span class="pre">exit</span></tt> the cluster and shut it down when you are done!</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem destroy &lt;cluster-name&gt;
</pre></div>
</div>
<p>Be careful, when you &#8220;destroy&#8221; a cluster, you forever lose any files or other information that you may have stored there.  If you simply want to pause your cluster so that you can return to using it later with its filesystems and data intact, you can instead &#8220;stop&#8221; and then &#8220;start&#8221; it again using these commands:</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem stop &lt;cluster-name&gt;
thunder-ec2 -k mykey -i ~/mykey.pem start &lt;cluster-name&gt;
</pre></div>
</div>
<p>When you stop a cluster, any data stored on the root partition (&#8216;/&#8217;) will be there when you start it back up again.  (Watch out: data on scratch disks like /mnt and /mnt2 will not be saved!)  Be aware that Amazon will charge you a tiny fee to store these so-called Elastic Block Store (EBS) volumes when you are not using them.</p>
</div>
<div class="section" id="use-the-ipython-notebook">
<h2>Use the iPython notebook<a class="headerlink" href="#use-the-ipython-notebook" title="Permalink to this headline">¶</a></h2>
<p>The iPython notebook is an especially useful way to do analyses interactively and look at results.  In order to connect to the iPython notebook with your web browser, you will need to establish access to the iPython server running on your EC2 master node.  There are two methods for doing this, described below.  Both methods work equally well, but one or the other may be better suited to your particular workflow so we leave it up to you to choose!</p>
<p><strong>Method 1: Connect directly over SSL</strong></p>
<p>This method allows you to connect directly to iPython notebook on EC2 over an encrypted (SSL) connection.  To do this, you will need to do one manual port configuration on the AWS console website. Go to the <a class="reference external" href="https://console.aws.amazon.com/ec2/v2/home">EC2 dashboard</a>, click on &#8220;Security groups&#8221; in the list on the left, and find the name of your cluster in the list, and click on the entry &#8220;&lt;cluster-name&gt;-master&#8221;. So if you called your cluster &#8220;test&#8221;, look for &#8220;test-master&#8221;. After selecting it, in the panel below, click the &#8220;Inbound&#8221; tab, click &#8220;Edit&#8221;, click &#8220;Add rule&#8221;, then type 8888 in the port range, and select &#8220;Anywhere&#8221; under source, then click &#8220;Save&#8221;.</p>
<p>The rest is easy. Just log in to your cluster</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem login &lt;cluster-name&gt;
</pre></div>
</div>
<p>If this is the first time you are logging in, you must run a script that configures iPython notebook to run in SSL mode.  Type:</p>
<div class="highlight-bash"><div class="highlight"><pre>setup-notebook-ec2
<span class="nb">source</span> /root/.bash_profile
</pre></div>
</div>
<p>During the script you will be asked to enter a password. Rememember what you give, as we&#8217;ll need it again soon. At the end of the configuration you&#8217;ll see the message <tt class="docutils literal"><span class="pre">iPython</span> <span class="pre">notebook</span> <span class="pre">successfully</span> <span class="pre">set</span> <span class="pre">up!</span></tt> followed by a link to a URL. If you now type:</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder
</pre></div>
</div>
<p>and go to the URL from the previous step in a web browser.  It will ask for the password we gave (if you get a message about SSL security, just click proceed). You are now running an iPython notebook server! Click <tt class="docutils literal"><span class="pre">New</span> <span class="pre">Notebook</span></tt> to start a session.  This URL will be accessible for as long as your cluster and iPython notebook are running.</p>
<p><strong>Method 2: Connect through an SSH Tunnel:</strong></p>
<p>This method uses the SSH protocol to establish a &#8220;tunnel&#8221; that routes network traffic from a port of your choosing on your local machine to and from the iPython notebook on the remote machine.  In essence, it makes it looks as though the remote iPython notebook is running on &#8216;localhost&#8217; (i.e. the hostname of your local machine).</p>
<p>To connect to iPython notebok over an SSH tunnel, login to your cluster with</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder-ec2 -k mykey -i ~/mykey.pem login &lt;cluster-name&gt; --ssh-port-forwarding &lt;local_port&gt;:8888
</pre></div>
</div>
<p>A typical choice for &lt;local_port&gt; is 8888.  However, you may need to choose another port if, for example, port 8888 is already in use by another process.</p>
<p>If this is the first time you are logging in to your cluster, you must run a script that configures iPython notebook to run in SSH tunnel mode.  Type:</p>
<div class="highlight-bash"><div class="highlight"><pre>setup-notebook-ec2-sshtunnel
</pre></div>
</div>
<p>Once you have done this, you are ready to run thunder!</p>
<div class="highlight-bash"><div class="highlight"><pre>thunder
</pre></div>
</div>
<p>Simply point your browser at <a class="reference external" href="http://localhost">http://localhost</a>:&lt;local_port&gt; and you will connect (over the SSH tunnel) to your iPython notebook server. Click <tt class="docutils literal"><span class="pre">New</span> <span class="pre">Notebook</span></tt> to start a session.</p>
<p>Note that although the SSH tunnel method involves less setup than the SSL method, it does require that you remain logged into your cluster whenever you wish to access the iPython notebook.  Once you log out, the SSH tunnel is disconnected. Of course, iPython is still running on your server, and you can access your running notebooks as soon as you log back in.  Just be sure to include the &#8211;ssh-port-forwarding option every time!</p>
<p>As a final word of caution: for now these two methods are mutually exclusive.  You can only use one of the above methods at a time.  However, if you change your mind simply remove the &#8216;/root/.ipython&#8217; directory on your EC2 master node and then follow the instruction above to switch methods.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/install_ec2.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>